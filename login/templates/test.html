<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <script src="http://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.12.5/umd/popper.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.min.js"></script>
    <script src="http://cdn.bootcss.com/typeahead.js/0.11.1/typeahead.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-treeview@1.2.0/dist/bootstrap-treeview.min.js"></script>
    <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.css" rel="stylesheet">

    <style>
        body {
            font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
        }

        #cy {
            position: absolute;
            left: 30%;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 1;
            opacity: 0.7;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            window.cy = cytoscape({
                container: document.getElementById('cy'),
                style: [{
                    selector: 'node',
                    css: {
                        'content': 'data(name)',
                        'text-valign': 'center',
                        'color': 'white',
                        'text-outline-width': 2,
                        'text-outline-color': '#888',
                        'background-color': '#888'
                    }
                },
                    {
                        selector: 'edge',
                        css: {
                            'background-color': 'black',
                            'line-color': 'black',
                            'target-arrow-color': 'black',
                            'source-arrow-color': 'black',
                            'text-outline-color': 'black'
                        }
                    },
                ],
                elements: {
                    nodes: [
                        {data: {id: 'one', name: 'Cytoscape'}},
                        {data: {id: 'two', name: 'example'}},
                    ],
                    edges: [
                        {data: {source: 'one', target: 'two'}}
                    ]
                },
                layout: {name: 'cose'}
            });
        })

        var tree = []
        window.onload = function init() {
            $.ajax({
                type: "GET",
                url: "http://127.0.0.1:8000/get_json/",
                success: function (res) {
                    tree = res.data.nodes
                    $('#tree').treeview({
                        data: tree,
                        highlightSelected: true,
                        multiSelect: false,
                    });
                }
            })
        }

        function load_network() {

            $.ajax({
                type: "GET",
                url: "/networks",
                data: {
                    network_id: document.getElementById('network_id').value
                },
                success: function (res) {
                    cy.destroy()
                    console.log(res.nodes)
                    window.cy = cytoscape({
                        container: document.getElementById('cy'),
                        style: res.style,
                        elements: {
                            nodes: res.nodes,
                            edges: res.edges,
                        },
                        layout: {name: 'cose'}
                    });
                    alertNode()
                    double_click_node()
                }
            })
        }

        function alertNode() {
            cy.on('onetap', 'node', function (e) {
                var node = e.target;
                alert('tapped ' + node.data("name"));
            });
        }


        function double_click_node() {
            cy.on('dbltap', 'node', function (e) {
                var node = e.target;
                cy.zoom({
                    level: 1.5,
                    position: cy.getElementById(node.id).position()
                });
            });
        }

        function do_mcl() {
            $.ajax({
                type: "GET",
                url: "/do_mcl",
                success: function (res) {
                    cy.destroy()
                    console.log(res.style)
                    window.cy = cytoscape({
                        container: document.getElementById('cy'),
                        style: res.style,
                        elements: {
                            nodes: res.nodes,
                            edges: res.edges,
                        },
                        layout: {name: 'cose'}
                    });
                    alertNode()
                    double_click_node()
                }
            })
        }

        function do_coloring() {
            $.ajax({
                type: "GET",
                url: "/color",
                success: function (res) {
                    cy.destroy()
                    window.cy = cytoscape({
                        container: document.getElementById('cy'),
                        style: res.style,
                        elements: {
                            nodes: res.nodes,
                            edges: res.edges,
                        },
                        layout: {name: 'cose'}
                    });
                    alertNode()
                    double_click_node()
                }
            })
        }
    </script>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
<!-- container section start -->
<section id="container" class="">
    <ul class="nav">
        <li class="nav-item">
            <a class="nav-link" id="proteins_tab" href="{% url 'proteins' %}">proteins</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'plot' %}">visualization</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" href="{% url 'cy' %}">networks</a>
        </li>
    </ul>
</section>
<div class="col-sm-4">
    <section class="panel">
        <a>please select a network</a>
        <select id="network_id" class="form-control form-control-placeholder">
<!--            <option value="-1" disabled selected hidden>please select</option>-->
            <option value="n1">gu_core_filtered_directed_network</option>
            <option value="n2">gu_periphery_filtered_directed_network</option>
            <option value="n3">nacl_core_filtered_directed_network</option>
            <option value="n4">nacl_periphery_filtered_directed_network</option>
            <option value="n5">sds_core_filtered_directed_network</option>
            <option value="n6">sds_periphery_filtered_directed_network</option>
        </select>
        <br><br><br><br><br>
        <button type="submit" onclick="load_network()">show network</button>
        <button type="submit" onclick="do_mcl()">do cluster</button>
        <br>
        <button type="submit" onclick="do_coloring()">do coloring</button>
        <a>please select a network coloring file</a>
        <div id="tree"></div>
    </section>
</div>
<div id="cy"></div>
</body>

</html>
